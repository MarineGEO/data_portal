---
title: ""
output: 
  md_document: 
    variant: markdown
---

  <br />
  <br />

<img src="www/Logomark_MarineGEO_Tennenbaum_RGB.png" width="319" height="100"/>

  <br />
  <br />

## Data Submission Report
#### Report date: `r as.character(Sys.Date())`
#### Submitted by `r as.character(input$email)`
#### Synthesis status: `r report_status()`

This report documents whether the data submission passes MarineGEO's quality assurance/quality control tests. If your submission failed one of the tests, you can view which protocol and sheet failed the test. Please update your data to fix any issues based on this information. If you cannot determine how to interpret a result, modify your data, or believe your data should be able to pass the tests, email MarineGEO (marinegeo@si.edu). 

Once you've addressed any issues(s), resubmit ONLY the data associated with the failed submission. 

  <br />

### Data Visualization

```{r echo=FALSE, results='asis'}
# Plot all coords in protocol submission ##########

print("This is the part where the map will go.")

# if(nrow(submission_coords$all_coords) > 0){
  print(kable(submission_coords$all_coords))
  
# Experiment with leaflet
# library(leaflet)
# 
#   # define palette 
#   pal <- colorFactor(palette = "Set3", 
#                      coords$protocol)
#   
#   # plot coordinates
#   leaflet(coords) %>% 
#     addProviderTiles(providers$CartoDB) %>%
#     # addTiles() %>%
#     addCircleMarkers(lng = ~longitude_1, lat = ~latitude_1, radius = 5, color = ~pal(protocol)) %>%
#     addLegend(pal = pal, values = ~protocol)
#   
#   # # plot transects
#   # transect_df <- with(transect_coords,
#   #               data.frame(group = c("A", "B"),
#   #                          protocol = protocol,
#   #                          lat = c(latitude_1, latitude_2),
#   #                          long = c(longitude_1, longitude_2))
#   # )
#   # 
#   # leaflet()%>%
#   #   addProviderTiles(providers$CartoDB) %>%
#   #   # problem: Polylines will connect the transects
#   #   addPolylines(data = transect_df, lng = ~long, lat = ~lat, group = ~group, 
#   #                color = ~pal(protocol), weight = 1)
  # }
```

  <br />

### QA/QC Test Results

If any files failed a QA test, the following table will describe which uploaded file, sheet, column, row, and value (if applicable) triggered the errors. You can read a description of each test in the section beneath the table. 

```{r echo=FALSE, results='asis'}
  
if(nrow(QA_results$df) > 0){
  report_warnings <- filter(warnings, title %in% QA_results$df$test)
  
  print(   
    kable(
      QA_results$df %>%
        select(test, filename, sheet_name, column_name, row_numbers, values) %>%
        distinct()
    )
  )
  
  cat("\n", "\n")
  
}



```

  <br />

```{r echo=FALSE, results='asis'}
  
# Provide definitions of any failed tests

if(nrow(QA_results$df) > 0){
  
  cat("### Explanation of Test Results", 
        "\n", "\n")
  
  report_warnings <- filter(warnings, title %in% QA_results$df$test)
  
  for(i in 1:nrow(report_warnings)){
    warning <- report_warnings[i,]
    
    cat("####", warning$title, 
        "\n",
        warning$message, "\n", "\n")
    
  }
  
  
}



```

  <br />
  <br />
